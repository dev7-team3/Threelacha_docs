# RDS 도입 결정: 대시보드 조회 성능 개선을 위한 데이터베이스 이중화
<div align="right">📅 2025-12-24</div>

> 💡 요약 <br><br>
> 본 프로젝트는 초기 설계에서 S3 단일 저장소와 Athena 쿼리 엔진을 사용하는 서버리스 아키텍처를 채택하였으나, 대시보드 조회 시 발생한 성능 문제(약 5초 체감 지연)를 해결하기 위해 RDS PostgreSQL을 추가로 도입하기로 결정하였다. Gold Layer 데이터를 S3와 RDS에 이중 저장하는 구조로, Athena는 배치 분석 및 데이터 마트 생성 용도로, RDS는 대시보드 조회 용도로 워크로드를 분리하여 각각의 최적화된 환경에서 운영하고자 한다.

## 1. Context (배경 및 문제 정의)

본 프로젝트는 초기 설계 단계에서 [ADR-001](./adr-001-production-db-use-status.md)에 따라 **S3를 단일 저장소로 유지하고 Athena를 쿼리 엔진으로 사용하는 서버리스 아키텍처**를 채택하였다. 이는 운영 복잡도와 비용을 줄이면서도 데이터 파이프라인의 일관성과 확장성을 확보하기 위한 결정이었다.

그러나 실제 대시보드를 구축하고 운영하는 과정에서 다음과 같은 성능 문제가 발생하였다:

- **대시보드 조회 시 체감 지연 발생**: Streamlit 대시보드에서 데이터를 조회할 때 응답 시간이 수 초 이상 소요되어 사용자 경험에 직접적인 영향을 미침
- **단일 쿼리 성능 차이**: 동일한 쿼리를 PostgreSQL과 Athena에서 각각 실행한 결과, 평균적으로 약 10배 이상의 시간 차이 확인
  - PostgreSQL: 약 0.1초 이내
  - Athena: 약 1.5초 이내
- **누적 지연 시간**: 대시보드 한 페이지에 3~4개의 쿼리가 동시에 실행되면서, 단일 쿼리당 평균 1.5초의 지연이 누적되어 약 5초 정도의 체감 지연 발생

**성능 비교 실험 결과**

<img width="907" height="52" alt="rds_log" src="https://github.com/user-attachments/assets/effe2fc4-8440-4039-a3a3-147797889c90" />

<img width="1024" height="52" alt="athena_log" src="https://github.com/user-attachments/assets/2de136c0-e179-4525-aecd-0460faebd99a" />

## 2. Decision (결정)

- **RDS PostgreSQL을 추가로 도입**하여 Gold Layer 데이터를 S3와 RDS에 이중 저장
- Streamlit 대시보드의 데이터 소스를 Athena에서 RDS로 전환
- Athena는 대용량 배치 분석 및 데이터 마트 생성 용도로 계속 활용
- RDS는 대시보드 조회 전용으로 사용하여 워크로드 분리

하는 **하이브리드 데이터 아키텍처**를 채택하였다.

## 3. Alternatives Considered (고려했던 대안들)

### 3.1 Athena 쿼리 결과 캐싱 활용

- Athena의 쿼리 결과 캐싱 기능을 활용하여 반복 조회 성능 개선
- 동일한 쿼리에 대한 캐시 히트 시 빠른 응답 가능

**장점**

- 추가 인프라 구축 없이 Athena 기능만으로 성능 개선 가능
- 비용 증가 없이 캐싱 효과 활용 가능

**단점**

- 캐시 히트율이 낮을 경우 여전히 지연 발생
- 실시간 데이터 반영 시 캐시 무효화로 인한 추가 오버헤드
- 대시보드의 다양한 쿼리 패턴에 대해서는 캐시 효과가 제한적
- 근본적인 아키텍처 불일치 문제 해결 불가

### 3.2 데이터베이스 이중화 (RDS 도입)

- Gold Layer 데이터를 S3와 RDS에 동시에 저장
- 대시보드 조회는 RDS를 통해 수행
- Athena는 배치 분석 용도로 계속 활용

**장점**

- 빠른 조회 성능 확보 (약 10배 이상 성능 개선)
- Athena는 배치 분석 용도로 계속 활용 가능
- 워크로드 분리로 각각의 최적화된 환경에서 운영
- 대시보드 사용자 경험 대폭 향상

**단점**

- 데이터 동기화 로직 추가 필요
- 스토리지 비용 증가 (S3 + RDS)
- RDS 인프라 관리 부담 추가
- 초기 설계와 다른 아키텍처로 인한 복잡도 증가


## 4. Rationale (결정의 이유)

- **사용자 경험 개선의 우선순위**
  - 대시보드는 프로젝트의 최종 결과물로 사용자에게 직접 노출되는 서비스
  - 약 5초의 체감 지연은 사용자 경험에 치명적인 영향을 미침
  - 성능 비교 실험 결과, PostgreSQL이 Athena 대비 약 10배 이상 빠른 응답 속도를 보여 실질적인 성능 개선 효과 기대
  - 현재 구조(Athena만 사용)를 유지할 경우, 근본적인 성능 문제 해결이 불가능하여 사용자 경험 저하가 지속됨

- **대안 배제 이유**
  - **Athena 쿼리 결과 캐싱(3.1)**: 캐시 히트율이 낮고 다양한 쿼리 패턴에 대해서는 효과가 제한적이며, 근본적인 아키텍처 불일치 문제를 해결하지 못함

- **워크로드 특성에 맞는 아키텍처 선택**
  - 대시보드는 **소량의 데이터를 빈번하게 조회**하는 OLTP(Online Transaction Processing) 성향의 워크로드
  - Athena는 **대용량 데이터를 배치로 분석**하는 OLAP(Online Analytical Processing) 성향의 쿼리 엔진
  - 각 워크로드에 최적화된 환경에서 운영하는 것이 효율적

- **하이브리드 아키텍처의 실용성**
  - Athena는 배치 분석 및 데이터 마트 생성 용도로 계속 활용하여 초기 설계의 장점 유지
  - RDS는 대시보드 조회 전용으로 사용하여 빠른 응답 속도 확보

- **장기적 운영 안정성**
  - 대시보드 조회 성능이 안정적으로 확보되면 사용자 만족도 향상
  - 워크로드 분리로 각 시스템의 부하를 독립적으로 관리 가능
  - 향후 대시보드 기능 확장 시에도 빠른 응답 속도 유지 가능

## 5. Consequences (영향 및 결과)

### 긍정적 영향

- **응답 시간 개선**: 단일 쿼리 응답 시간이 1.5초에서 0.1초 이내로 단축
- **워크로드 분리**: Athena는 배치 분석, RDS는 대시보드 조회로 용도 분리하여 각각의 최적화된 환경에서 운영 가능
- **시스템 안정성**: 대시보드 조회와 배치 분석이 서로 영향을 주지 않아 시스템 안정성 향상

### 한계 및 트레이드오프

- **인프라 복잡도 증가**: S3와 RDS를 동시에 운영하여 관리 포인트 증가
- **비용 증가**: RDS 인프라 운영 비용 추가 (db.t3.micro 사용으로 최소화)
- **데이터 동기화 필요**: Gold Layer 데이터를 S3와 RDS에 동시에 저장하는 ETL 단계 추가
- **초기 설계와의 불일치**: ADR-001에서 결정한 S3 단일 저장소 구조에서 벗어나 하이브리드 아키텍처로 변경

**실제 운영 경험을 바탕으로 한 아키텍처 개선**으로, 사용자 경험을 우선시한 실용적인 결정이었다.

## 6. Related Decisions (관련 ADR 문서)

- [ADR-001: 프로덕션 DB 사용여부 판단](./adr-001-production-db-use-status.md) - 초기 S3 단일 저장소 결정을 변경하는 결정

## 7. References (참고 자료)

- [상세내용: RDS 도입 배경 - Athena 쿼리 지연 문제](../보고서/상세내용/background_of_use_rds.md)

