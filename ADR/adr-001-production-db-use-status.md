# 프로덕션 DB 사용여부 판단: Athena 쿼리엔진으로 S3 단일저장소 유지 결정
<div align="right">📅 2025-12-08</div>

> 💡 요약 <br><br>
> 본 프로젝트는 분석 및 조회 계층에서 Athena를 쿼리 엔진으로만 사용하고 S3를 단일 저장소로 유지하는 구조를 채택하였다. 이는 운영 복잡도와 비용을 줄이면서도 데이터 파이프라인의 일관성과 확장성을 확보하기 위함이다. 따라서, 컨테이너 기반 오케스트레이션과 서버리스 분석 엔진을 조합하여 프로젝트 요구사항에 최적화된 균형 잡힌 아키텍처를 구현하고자 하였다.


## 1. Context (배경 및 문제 정의)

본 프로젝트에서는 공공 농산물 가격 데이터를 주기적으로 수집하여 분석 및 시각화하는 데이터 파이프라인을 구축하고자 하였다. 서비스 특성 상 배치 기반 분석 및 집계 처리를 중심으로 설계하였으며 고빈도의 실시간 트랜잭션 처리기능은 필요하지 않았다.

이러한 상황에서 다음과 같은 설계 선택지가 존재했다.

- 1.1 분석 데이터를 별도의 Production Database 또는 데이터 웨어하우스에 적재하여 조회
- 1.2 또는 S3에 저장된 데이터를 직접 조회할 수 있는 **쿼리 엔진 중심 구조** 채택

## 2. Decision (결정)

- 1.2 또는 S3에 저장된 데이터를 직접 조회할 수 있는 **쿼리 엔진 중심 구조** 채택
    - S3를 단일 데이터 저장소로 유지
    - Athena는 쿼리 실행 엔진 역할만 수행
    - Glue Data Catalog를 통해 메타데이터를 관리

하는 **서버리스 분석 아키텍처**를 구성하였다.


## 3. Alternatives Considered (고려했던 대안들)

### 1.1 분석 데이터를 별도의 Production Database 또는 데이터 웨어하우스에 적재하여 조회

#### 1.1.1 전통적인 데이터 웨어하우스 사용 (예: Amazon Redshift, Snowflake 등)

- 데이터 마트(Gold Layer) 데이터를 전용 데이터 웨어하우스에 적재
- 컬럼형 스토리지 기반의 고성능 분석 쿼리 지원
- SQL 기반 조회 및 서비스 연계

**장점**

- 대용량 데이터 분석에 최적화된 성능
- 복잡한 집계 쿼리 및 분석 작업에 유리
- 전통적인 데이터 웨어하우스 아키텍처로 검증된 구조

**단점**

- **높은 인프라 운영 비용**: 데이터 웨어하우스는 클러스터 운영 비용이 높음 (Redshift의 경우 최소 클러스터 비용 발생)
- **프로젝트 규모 대비 과도한 구성**: 초기 데이터 규모가 크지 않은 프로젝트에는 비용 대비 효과가 낮음
- **인프라 관리 부담**: 클러스터 관리, 스케일링, 백업 등 운영 복잡도 증가
- **데이터 적재 오버헤드**: S3에서 데이터 웨어하우스로 데이터를 적재하는 추가 ETL 단계 필요

#### 1.1.2 전통적인 RDBMS 사용 (예: PostgreSQL, MySQL 등)

- 데이터 마트(Gold Layer) 데이터를 RDBMS에 적재
- SQL 기반 조회 및 서비스 연계

**장점**

- 빠른 쿼리 응답 시간
- OLTP 성향의 워크로드에 적합
- 익숙한 데이터베이스 관리 방식

**단점**

- **인프라 운영 및 비용 부담**: RDS 등 관리형 서비스 사용 시 지속적인 비용 발생
- **스키마 변경 시 운영 복잡도 증가**: 데이터 구조 변경 시 마이그레이션 작업 필요
- **프로젝트 규모 대비 과도한 구성**: 초기에는 단순한 분석 요구사항에 대비해 복잡도가 높음
- **확장성 제약**: 대용량 데이터 분석 시 성능 한계 존재

### 1.2 S3에 저장된 데이터를 직접 조회할 수 있는 **쿼리 엔진 중심 구조** 채택

- 별도 DB 없이 S3 데이터를 직접 조회
- 서버리스 환경에서 분석 수행

**단점**

- **쿼리 지연 시간**
    - Athena는 파일 스캔 기반 쿼리 엔진이기 때문에 전통적인 RDBMS 대비 쿼리 응답 시간이 상대적으로 느림
- **고빈도 트랜잭션 처리 부적합**
    - 동시 접속이 많거나 짧은 쿼리를 반복적으로 수행하는 서비스에는 적합하지 않음
- **쿼리 비용 관리 필요**
    - 스캔 데이터 양에 따라 비용이 발생하므로 파티션, 컬럼 선택, 포맷 설계에 대한 고려가 필수적
- **스키마 설계 의존도 증가**
    - 파일 포맷(Parquet) 및 파티션 설계가 성능과 안정성에 직접적인 영향을 미침


## 4. Rationale (결정의 이유)

- **운영 복잡도의 감소**
    - 별도의 Production DB를 두지 않고 S3를 단일 저장소로 유지
    - 인프라 관리 부담을 최소화
- 데이터 레이어 일관성 유지
    - Raw → Silver → DataMart(Gold)까지 데이터를 모두 S3에서 관리
    - 데이터 중복 저장을 최소화
- 유연한 확장성
    - 프로젝트 초기에 데이터 규모가 크지 않았으나, S3 기반 구조는 데이터가 늘어나도 확장성이 뛰어나므로 장기적으로 안정적임을 고려
    - S3와 네이티브하게 통합되어 별도의 ETL 과정 없이 데이터를 직접 조회할 수 있다는 점에서 프로젝트 요구사항과 가장 잘 맞다고 판단하였다.
- 비용 및 리소스의 최적화
    - 데이터 웨어하우스(Redshift 등)나 전통적인 RDBMS를 운영하지 않기 때문에 초기 비용과 관리 부담을 크게 줄일 수 있음
    - Athena는 사용한 만큼 비용이 발생하는 구조라서 프로젝트 규모에 적합
    - 데이터 웨어하우스는 최소 클러스터 비용이 발생하지만, Athena는 쿼리 실행 시에만 비용이 발생하여 초기 비용 부담이 적음
- 부분적 서버리스 활용
    - 데이터 수집과 변환은 컨테이너 기반으로 운영했지만, 쿼리 실행과 저장소 관리에서는 서버리스 특성을 활용하기로 하였다. 필요한 부분만 서버리스로 가져와 운영 부담을 줄이고, 나머지는 컨테이너로 제어하여 유연하게 자원을 관리할 수 있었다.


## 5. Consequences (영향 및 결과)

### 긍정적 영향

- Production DB 운영 없이도 분석 및 시각화 요구사항 충족
- 데이터 저장소(S3)와 쿼리 엔진(Athena)의 역할 분리
- 클라우드 네이티브한 데이터 파이프라인 경험 확보
- 파이프라인 구조 단순화로 유지보수성 향상

### 한계 및 트레이드오프

- Athena는 대규모 배치 분석에는 적합하지만, 짧은 응답 시간이 필요한 대화형 쿼리나 고빈도 요청에는 성능 제약이 존재한다
- 고빈도 쿼리 또는 동시 접속이 많은 서비스에는 부적합
- 쿼리 성능 최적화를 위한 파티션·포맷 설계 중요성 증가

본 프로젝트에서는 이러한 한계를 인지한 상태에서, **분석 중심 프로젝트에 가장 적합한 구조**로 Athena 기반 설계를 채택하였다.

## 6. Related Decisions (관련 ADR 문서)

- 없음

## 7. References (참고 자료)

- [(2.2) 파이프라인 초안 구성](https://www.notion.so/2-2-2b96e9180a968050a29eef185635c054?pvs=21)